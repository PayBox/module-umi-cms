# module-umi-cms

#### Тестировалось и писалось для UMI.CMS версия 2.9.6

1. Регистрируемся на <a href="https://paybox.money" target="_blank">paybox.money</a>
2. Заходим в административную часть сайта в раздел модули->шаблоны данных->способы оплаты и нажимаем добавить
3. Добавляем поля:
4. Запоминаем id платежного метода из строки браузера (зайдя в редактировнаие метода, пример: http://umicms.local/admin/data/type_edit/139/)
5. Заходим в раздел справичники->типы способов оплат->посмотреть и нажимаем добавить наименование справочника
6. Заходим в phpmyadmin (или если есть панель управления базой данных через административную панель хостинг провайдера) и исполняем запрос
UPDATE `cms3_object_types` SET `guid` = 'emarket-payment-139' WHERE `cms3_object_types`.`id` =139;
Где 139 – id платежного метода.
7. Копируем папку classes в корень сайта
8. Копируем в папку templates\name_template из архива в ваш шаблон папку tpls
9. Ищем файл, который находится у вас по адресу templates\name_template\xslt\modules\emarket\purchase\payment.xls
Открываем его и после любого блока
<xsl:template match="item" mode="payment">
</xsl:template>
Вставляем содержимое файла в архиве по аналогичному адресу.
10. Заходим в раздел Модули->интернет магазин->оплата и добавляем новый метод оплаты (заполняем данные из личного кабинета paybox). **
11. Заходим в раздел Модули->Шаблоны данных->Пользователь и добавьте обязательное поле в раздел доставка

** Чтобы не принимать оплату по конкретной транзакции нужно поменять статус заказа или оплаты на отменен.
** Если вы хотите чтобы ПС выбиралась на стороне магазина – нужно добавить столько обработчиков, сколько ПС подключено у Вас в личном кабинете Paybox. При этом в поле payment_system надо ввести название платежной системы, на которую будет ссылаться метод оплаты. Далее в Ваш шаблон (default.tpl или default.xsl, которые находились в архиве) необходимо добавить строку:
￼<input type="hidden" name="pg_payment_system" value="%pg_payment_system%" />

